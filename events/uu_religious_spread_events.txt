namespace = religion

################################################
## Religious spread to children 1 - 3
#################################################

pop_event = {
	id = religion.1
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		owner = {
			has_modifier = empire_state_religion_amarr_faith
		}
		NOT = { 
		# Materialist pops are never religious
			or = {
				pop_has_ethic = "ethic_materialist"
				pop_has_ethic = "ethic_fanatic_materialist"
			}
		}
	}
	
	immediate = {
		if = {
			# Spiritualist POPs always adopt a religion
			limit = {
				or = {
					pop_has_ethic = "ethic_spiritualist"
					pop_has_ethic = "ethic_fanatic_spiritualist"
				}
			}
			set_pop_flag = amarr_faith
			
			else = {
				if = {
					limit = {
						owner = {
							has_policy_flag = tolerant_state_religion
						}
					}
					random_list = {
						150 = { set_pop_flag = amarr_faith }
						50 = { }
						10 = { set_pop_flag = sani_sabik }
					}
					else = {
						random_list = {
							150 = { set_pop_flag = amarr_faith }
							50 = { }
						}
					}
				}			
			}
		}
	}
}

pop_event = {
	id = religion.2
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		owner = {
			has_modifier = empire_state_religion_sani_sabik
		}
		NOT = { 
		# Materialist pops are never religious
			or = {
				pop_has_ethic = "ethic_materialist"
				pop_has_ethic = "ethic_fanatic_materialist"
			}
		}
	}
	
	immediate = {
		if = {
			# Spiritualist POPs always adopt a religion
			limit = {
				or = {
					pop_has_ethic = "ethic_spiritualist"
					pop_has_ethic = "ethic_fanatic_spiritualist"
				}
			}
			set_pop_flag = sani_sabik
			
			else = {
				if = {
					limit = {
						owner = {
							has_policy_flag = tolerant_state_religion
						}
					}
					random_list = {
						150 = { set_pop_flag = sani_sabik }
						50 = { }
						10 = { set_pop_flag = amarr_faith }
					}
					else = {
						random_list = {
							150 = { set_pop_flag = sani_sabik }
							50 = { }
						}
					
					}
				}			
			}
		}
	}
}

pop_event = {
	id = religion.3
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		owner = {
			has_policy_flag = freedom_of_religion
		}
		planet = {
			any_pop = {
				has_pop_flag = amarr_faith
			}
		}
		NOT = { 
		# Materialist pops are never religious
			or = {
				pop_has_ethic = "ethic_materialist"
				pop_has_ethic = "ethic_fanatic_materialist"
			}
		}
	}
	
	
	immediate = {
		if = {
			limit = {
				planet = {
					AND = {
						any_pop = {
							has_pop_flag = amarr_faith
						}
						any_pop = {
							has_pop_flag = sani_sabik
						}
					}		
				}			
			}
			if = {
				# Spiritualist POPs always adopt a religion
				limit = {
					or = {
						pop_has_ethic = "ethic_spiritualist"
						pop_has_ethic = "ethic_fanatic_spiritualist"
					}
				}
				
				random_list = {
					50 = { set_pop_flag = amarr_faith }
					50 = { set_pop_flag = sani_sabik }		
				}
				else = {
					random_list = {
						50 = { set_pop_flag = amarr_faith }
						50 = { set_pop_flag = sani_sabik }
						50 = { } # With non spiritualist pops there is a chance that no religion is spread.
					}
				}
			}
			break = yes
		}
		
		if = {
			limit = {
				planet = {
					any_pop = {
						has_pop_flag = amarr_faith
					}
				}
			}
			if = {
				# Spiritualist POPs always adopt a religion
				limit = {
					or = {
						pop_has_ethic = "ethic_spiritualist"
						pop_has_ethic = "ethic_fanatic_spiritualist"
					}
				}
				set_pop_flag = amarr_faith
				else = {
					random_list = {
						50 = { set_pop_flag = amarr_faith }
						150 = {	}
					}
				}
			}
			break = yes
		}
		
		if = {
			limit = {
				planet = {
					any_pop = {
						has_pop_flag = sani_sabik
					}
				}
			}
			if = {
				# Spiritualist POPs always adopt a religion
				limit = {
					or = {
						pop_has_ethic = "ethic_spiritualist"
						pop_has_ethic = "ethic_fanatic_spiritualist"
					}
				}
				set_pop_flag = sani_sabik
				
				else = {
					random_list = {
						50 = { set_pop_flag = sani_sabik }
						150 = { }
					}
				}
			}
			break = yes
		}
	}
}
	
#####################################
## Colonial Religious Spread 4
######################################
planet_event = {
	id = religion.4
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_pop = {
			if = {
				limit = {
					owner = {
						has_modifier = empire_state_religion_amarr_faith
					}
				}
				set_pop_flag = amarr_faith
				else = {
					if = {
						limit = {
							owner = {
								has_modifier = empire_state_religion_sani_sabik
							}
						}
						set_pop_flag = sani_sabik
					}
				}
			}
		}
	}
}


######################################
### Yearly Religious Spread 5
######################################

event = {
	id = religion.5
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		every_country = {
			if = {
				limit = {
					has_policy_flag = freedom_of_religion
				}
				every_owned_planet = {
					if = {
						limit = {
							AND = {
								any_pop = {
									has_pop_flag = amarr_faith
								}
								any_pop = {
									has_pop_flag = sani_sabik
								}
							}
						}
						random_pop = {
							limit = {
								NOR = {
									pop_has_ethic = "ethic_materialist"
									pop_has_ethic = "ethic_fanatic_materialist"
								}
							}
							if = {
								limit = {
									has_pop_flag = amarr_faith
								}
								
								if = {
									limit = {
										pop_has_ethic = "ethic_spiritualist"
										pop_has_ethic = "ethic_fanatic_spiritualist"
									}
									
									random_list = {
										50 = {
											# Become Sani Sabik
											remove_pop_flag = amarr_faith
											set_pop_flag = sani_sabik
										}
										150 = {
											# Remain Amarr Faith
										}
									}
									
									else = {
										random_list = {
											50 = {
												# Become Sani Sabik
												remove_pop_flag = amarr_faith
												set_pop_flag = sani_sabik
											}
											50 = {
												# become non - religious
												remove_pop_flag = amarr_faith
											}
											50 = {
												# remain amarr faith
											}
										}
									}
								}					
								else = {
									if = {
										limit = {
											has_pop_flag = sani_sabik
										}
										if = {
											limit = {
												pop_has_ethic = "ethic_spiritualist"
												pop_has_ethic = "ethic_fanatic_spiritualist"
											}
											
											random_list = {
												50 = {
													# Become Amarr Faith
													remove_pop_flag = sani_sabik
													set_pop_flag = amarr_faith
												}
												200 = {
													# Remain Sani Sabik
												}
											}
											
											else = {
												random_list = {
													50 = {
														# Become Amarr Faith
														remove_pop_flag = sani_sabik
														set_pop_flag = amarr_faith
													}
													50 = {
														# become non - religious
														remove_pop_flag = sani_sabik
													}
													50 = {
														# remain sani sabik
													}
												}
											}
										}
										
										else = {
											if = {
												limit = {
													pop_has_ethic = "ethic_spiritualist"
													pop_has_ethic = "ethic_fanatic_spiritualist"
												}
												
												random_list = {
													50 = {
														remove_pop_flag = sani_sabik
														# Become Amarr Faith
														set_pop_flag = amarr_faith
													}
													50 = {
														remove_pop_flag = amarr_faith
														# Become Sani Sabik
														set_pop_flag = sani_sabik												
													}
												}									
												else = {
													random_list = {
														50 = {
															# Become Amarr Faith
															remove_pop_flag = sani_sabik
															set_pop_flag = amarr_faith
														}
														50 = {
															# Become Sani Sabik
															remove_pop_flag = amarr_faith
															set_pop_flag = sani_sabik
														}
														50 = {
															# Remain non-religious
														}
													}
												}
											}							
										}
									}
								}
							}							
						}
						break = yes
					}
					
					if = {
						limit = {
							any_pop = {
								has_pop_flag = amarr_faith
							}
						}
						random_pop = {
							limit = {
								NOR = {
									pop_has_ethic = "ethic_materialist"
									pop_has_ethic = "ethic_fanatic_materialist"
								}
							}
							if = {
								limit = {
									has_pop_flag = amarr_faith
								}
								if = {
									limit = {
										NOR = {
											pop_has_ethic = "ethic_spiritualist"
											pop_has_ethic = "ethic_fanatic_spiritualist"
										}
									}
									random_list = {
										50 = {
											# Become non-religious
											remove_pop_flag = amarr_faith
										}
										200 = { } # Remain Amarr Faith
									}	
								}
								
								else = {
									if = {
										limit = {
											OR = {
												pop_has_ethic = "ethic_spiritualist"
												pop_has_ethic = "ethic_fanatic_spiritualist"
											}
										}
										remove_pop_flag = sani_sabik
										set_pop_flag = amarr_faith
										
										else = {
											random_list = {
												50 = {
													## Become Amarr Faith
													remove_pop_flag = sani_sabik
													set_pop_flag = amarr_faith
												}
												200 = { } # Remain non-religious
											}
										}
									}
								}
							}						
						}
						break = yes	
					}
					
					if = {
						limit = {
							any_pop = {
								has_pop_flag = sani_sabik
							}
						}
						random_pop = {
							limit = {
								NOR = {
									pop_has_ethic = "ethic_materialist"
									pop_has_ethic = "ethic_fanatic_materialist"
								}
							}
							if = {
								limit = {
									has_pop_flag = sani_sabik
								}
								if = {
									limit = {
										NOR = {
											pop_has_ethic = "ethic_spiritualist"
											pop_has_ethic = "ethic_fanatic_spiritualist"
										}
									}
									random_list = {
										50 = {
											# Become non-religious
											remove_pop_flag = sani_sabik
										}
										200 = { } # Remain Sani Sabik
									}	
								}
								
								else = {
									if = {
										limit = {
											OR = {
												pop_has_ethic = "ethic_spiritualist"
												pop_has_ethic = "ethic_fanatic_spiritualist"
											}
										}
										remove_pop_flag = amarr_faith
										set_pop_flag = sani_sabik
										
										else = {
											random_list = {
												50 = {
													## Become Sani Sabik
													remove_pop_flag = amarr_faith
													set_pop_flag = sani_sabik
												}
												200 = { } # Remain non-religious
											}
										}
									}
								}
							}							
						}	
						break = yes
					}
				}	
			}
			
			if = {
				limit = {
					has_modifier = empire_state_religion_amarr_faith
				}
				every_owned_planet = {					
					if = {
						limit = {
							any_pop = {
								has_pop_flag = sani_sabik
							}
						}
						random_pop = {
							if = {
								limit = {
									has_pop_flag = sani_sabik
								}
								random_list = {
									200 = {
										# remain sani sabik
									}
									50 = {
										# become amarr faith
										remove_pop_flag = sani_sabik
										set_pop_flag = amarr_faith
									}
								}
								else = {
									if = {
										limit = {
											has_pop_flag = amarr_faith
										}
										if = {
											limit = {
												NOR = {
													pop_has_ethic = "ethic_spiritualist"
													pop_has_ethic = "ethic_fanatic_spiritualist"
												}
											}
											random_list = {
												300 = {
													## Remain Amarr Faith
												}
												10 = {
													## Become non-religious
													remove_pop_flag = amarr_faith
												}
											}
										}
										else = {
											if = {
												limit = {
													OR = {
														pop_has_ethic = "ethic_spiritualist"
														pop_has_ethic = "ethic_fanatic_spiritualist"
													}
												}
												remove_pop_flag = sani_sabik
												set_pop_flag = amarr_faith
												else = {
													random_list = {
														50 = { } ## Remain non-religious
														50 = {  ## Become Amarr Faith
															remove_pop_flag = sani_sabik
															set_pop_flag = amarr_faith
														}
													}
												}
											}
										}
									}
								}
							}
							break = yes
						}
					}
					
					random_pop = {
						if = {
							limit = {
								has_pop_flag = amarr_faith
							}
							if = {
								limit = {
									NOR = {
										pop_has_ethic = "ethic_spiritualist"
										pop_has_ethic = "ethic_fanatic_spiritualist"
									}
								}
								random_list = {
									10 = { remove_pop_flag = amarr_faith }
									300 = { }
								}
							}
							else = {
								random_list = {
									50 = {
										remove_pop_flag = sani_sabik
										set_pop_flag = amarr_faith
									}
									50 = { }
								}
							}
						}
					}
				}
			}
			
			if = {
				limit = {
					has_modifier = empire_state_religion_sani_sabik
				}
				every_owned_planet = {
					if = {
						limit = {
							any_pop = {
								has_pop_flag = amarr_faith
							}
						}
						random_pop = {
							if = {
								limit = {
									has_pop_flag = amarr_faith
								}
								random_list = {
									200 = {
										# remain amarr faith
									}
									50 = {
										# become sani sabik
										remove_pop_flag = amarr_faith
										set_pop_flag = sani_sabik
									}
								}
								else = {
									if = {
										limit = {
											has_pop_flag = sani_sabik
										}
										if = {
											limit = {
												NOR = {
													pop_has_ethic = "ethic_spiritualist"
													pop_has_ethic = "ethic_fanatic_spiritualist"
												}
											}
											random_list = {
												300 = {
													## Remain sani sabik
												}
												10 = {
													## Become non-religious
													remove_pop_flag = sani_sabik
												}
											}
										}
										else = {
											if = {
												limit = {
													OR = {
														pop_has_ethic = "ethic_spiritualist"
														pop_has_ethic = "ethic_fanatic_spiritualist"
													}
												}
												remove_pop_flag = amarr_faith
												set_pop_flag = sani_sabik
												else = {
													random_list = {
														50 = { } ## Remain non-religious
														50 = {  ## Become sani sabik
															remove_pop_flag = amarr_faith
															set_pop_flag = sani_sabik
														}
													}
												}
											}
										}
									}
								}
							}
							break = yes
						}
					}
					
					random_pop = {
						if = {
							limit = {
								has_pop_flag = sani_sabik
							}
							if = {
								limit = {
									NOR = {
										pop_has_ethic = "ethic_spiritualist"
										pop_has_ethic = "ethic_fanatic_spiritualist"
									}
								}
								random_list = {
									## Become non-religious
									10 = { remove_pop_flag = sani_sabik }
									300 = { } ## remain sani sabik
								}
							}
							else = {
								random_list = {
									50 = { ## Become sani sabik
										remove_pop_flag = amarr_faith
										set_pop_flag = sani_sabik
									}
									50 = { } ## remain non-religious
								}
							}
						}
					}
				}
			}
		}
	}
}
